{% extends 'admin/adminbase.html' %}

{% block title %}Organization Details{% endblock %}

{% block extra_js %}
<script>
  // Sticky header functionality
  document.addEventListener('DOMContentLoaded', function() {
    const orgHeader = document.querySelector('.organization-header');
    const stickyHeader = document.querySelector('.sticky-org-header');
    
    if (!orgHeader || !stickyHeader) {
      console.error('Could not find organization header or sticky header elements');
      return;
    }
    
    // Handle scroll event
    window.addEventListener('scroll', function() {
      // Show sticky header when the original header is about to disappear
      const headerRect = orgHeader.getBoundingClientRect();
      const headerBottom = headerRect.bottom;
      const headerHeight = headerRect.height;
      
      // Show sticky header when 75% of the original header has scrolled out of view
      if (headerBottom < headerHeight * 0.25) {
        stickyHeader.classList.add('visible');
      } else {
        stickyHeader.classList.remove('visible');
      }
    });
    
    // Trigger scroll event once to set initial state
    window.dispatchEvent(new Event('scroll'));
  });
</script>
{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/organizationdetails.css') }}?v={{ cache_version }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/organization.css') }}?v={{ cache_version }}">
<!-- Toastr CSS for toast notifications -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<!-- Load jQuery first (required for Toastr.js) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<!-- Toastr JS for toast notifications - loaded after jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<style>
  .organization-header {
    position: relative;
  }
  
  .rounded-2xl {
    border-radius: 1rem;
  }
  
  .text-gray-500 {
    color: #6b7280;
  }
  
  .text-gray-900 {
    color: #111827;
  }
  
  .border-gray-100 {
    border-color: #f3f4f6;
  }
  
  .btn-update-status {
    background-color: var(--button-color);
    color: white;
    border: none;
    border-radius: 0.375rem;
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
    cursor: pointer;
  }
  
  .btn-update-status:hover {
    background-color: var(--button-hover);
  }
</style>
{% endblock %}



{% block additional_content %}
    <!-- Hidden organization ID field for JavaScript use -->
    <input type="hidden" id="organization-id" value="{{ organization.organization_id if organization else '' }}">
    
    <!-- Sticky header that appears when scrolling -->
    <div class="sticky-org-header">
        {% if organization and organization.logo_id %}
        <img src="{{ url_for('user_organization.get_logo', logo_id=organization.logo_id) }}" alt="{{ organization.organization_name }} logo" class="sticky-org-logo">
        {% else %}
        <img src="https://placehold.co/40x40/png/ffffff/000000?text=Logo" alt="Organization logo" class="sticky-org-logo">
        {% endif %}
        <div class="sticky-org-info">
            <h3 class="sticky-org-title">{{ organization.organization_name if organization else 'Organization Name' }}</h3>
            {% if organization and organization.type %}
            <p class="sticky-org-type">{{ organization.type }}</p>
            {% endif %}
        </div>
    </div>
    
    <section class="organization-header org-card">
        <div class="d-flex justify-content-center align-items-center">
            <div class="d-flex flex-column flex-sm-row gap-5 align-items-center justify-content-center">
                {% if organization and organization.logo_id %}
                <img src="{{ url_for('user_organization.get_logo', logo_id=organization.logo_id) }}" alt="{{ organization.organization_name }} logo" title="{% if organization.logo.description %}{{ organization.logo.description }}{% else %}{{ organization.organization_name }} - {{ organization.type if organization.type else 'Organization' }} Logo{% endif %}" class="org-logo">
                {% else %}
                <img src="https://placehold.co/120x120/png/ffffff/000000?text=Logo" alt="Organization logo" title="Organization Logo" class="org-logo">
                {% endif %}
                <div class="flex-grow-1 text-start">
                    <h2 class="org-title">{{ organization.organization_name if organization else 'Organization Name' }}</h2>
                    {% if organization and organization.type %}
                    <p class="org-type"><strong>Type:</strong> {{ organization.type }}</p>
                    {% endif %}
                    {% if organization and organization.tagline %}
                    <p class="org-quote">"{{ organization.tagline }}"</p>
                    {% endif %}
                    {% if organization and organization.description %}
                    <p class="org-description">{{ organization.description }}</p>
                    {% else %}
                    <p class="org-description">No description available.</p>
                    {% endif %}
                    {% if adviser %}
                    <p class="org-adviser">{{ adviser.type if adviser.type else 'Adviser' }}: {{ adviser.full_name }}</p>
                    {% endif %}
                    {% if coadviser %}
                    <p class="org-adviser">{{ coadviser.type if coadviser.type else 'Co-Adviser' }}: {{ coadviser.full_name }}</p>
                    {% endif %}

                    <!-- Social Media Row -->
                    <div class="d-flex justify-content-between align-items-center flex-wrap mt-3">
                        <!-- Left Side: Print Button -->
                        <div class="my-auto gap-2">
                            <button type="button" class="btn btn-primary me-2 mb-2" style="font-size: 0.8rem;">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>

                        <!-- Right Side: Social Media Logos -->
                        <div class="org-social">
                            {% if social_media %}
                            <div class="d-flex gap-2">
                                {% for sm in social_media %}
                                <a href="{{ sm.link }}" target="_blank" title="{{ sm.platform }}">
                                    {% if sm.platform.lower() == 'facebook' %}
                                    <i class="fab fa-facebook" style="font-size: 1.5rem; color: #fff;"></i>
                                    {% elif sm.platform.lower() == 'twitter' %}
                                    <i class="fab fa-twitter" style="font-size: 1.5rem; color: #fff;"></i>
                                    {% elif sm.platform.lower() == 'instagram' %}
                                    <i class="fab fa-instagram" style="font-size: 1.5rem; color: #fff;"></i>
                                    {% elif sm.platform.lower() == 'messenger' %}
                                    <i class="fab fa-facebook-messenger" style="font-size: 1.5rem; color: #fff;"></i>
                                    {% else %}
                                    <i class="fas fa-link" style="font-size: 1.5rem; color: #fff;"></i>
                                    {% endif %}
                                </a>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="d-flex gap-2"></div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block content %}
<div class="container">
    <header class="mb-4">
    <div class="text-start">
        <a href="/admin/organization" class="back-link d-inline-flex align-items-center">
        <i class="fas fa-arrow-left me-1"></i> Back
        </a>
    </div>
    </header>

    <section class="stats-container">
        <div class="stat-card stat-members">
            <div>No. of Members</div>
            <div class="d-flex align-items-center fw-semibold fs-4">
                <i class="fas fa-users stat-icon"></i> {{ statistics.member_count if statistics else '35' }}
            </div>
        </div>
        
        <div class="stat-card stat-volunteers">
            <div>No. of Volunteers</div>
            <div class="d-flex align-items-center fw-semibold fs-4">
                <i class="fas fa-hand-holding-heart stat-icon"></i> {{ statistics.volunteer_count if statistics else '13' }}
            </div>
        </div>
        
        <div class="stat-card stat-activities">
            <div>Accomplished Activities</div>
            <div class="d-flex align-items-center fw-semibold fs-4">
                <i class="fas fa-tasks stat-icon"></i> {{ statistics.accomplished_activities if statistics else '2' }}
            </div>
        </div>
        
        <div class="stat-card stat-status">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                Organization Status
                {% if organization %}
                    <span class="status-{{ organization.status|lower }}">{{ organization.status }}</span>
                {% else %}
                    <span class="status-unknown">Unknown</span>
                {% endif %}
            </div>
            <button type="button" class="btn-update-status">Update Status</button>
        </div>
    </section>

    <!-- Tabbed interface for organization data -->
    <section class="tabs-container">
        <ul class="nav nav-tabs" id="organizationTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="officers-tab" data-bs-toggle="tab" data-bs-target="#officers" type="button" role="tab" aria-controls="officers" aria-selected="true">
                    Board of Officers
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="members-tab" data-bs-toggle="tab" data-bs-target="#members" type="button" role="tab" aria-controls="members" aria-selected="false">
                    Members
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="volunteers-tab" data-bs-toggle="tab" data-bs-target="#volunteers" type="button" role="tab" aria-controls="volunteers" aria-selected="false">
                    Volunteers
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="plans-tab" data-bs-toggle="tab" data-bs-target="#plans" type="button" role="tab" aria-controls="plans" aria-selected="false">
                    Plans
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="organizationTabsContent">
            <!-- Board of Officers Tab -->
            <div class="tab-pane fade show active" id="officers" role="tabpanel" aria-labelledby="officers-tab">
                <div class="table-container">
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:20%;">Position</th>
                                    <th style="width:20%;">Student Number</th>
                                    <th style="width:40%;">Name</th>
                                    <th style="width:20%;">Program</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if officers %}
                                    {% for officer in officers %}
                                    <tr>
                                        <td>{{ officer.position }}</td>
                                        <td>{{ officer.student_no }}</td>
                                        <td>{{ officer.name }}</td>
                                        <td>{{ officer.program }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="4" class="text-center">No officers found</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Members Tab -->
            <div class="tab-pane fade" id="members" role="tabpanel" aria-labelledby="members-tab">
                <div class="table-container">
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:10%;">No.</th>
                                    <th style="width:25%;">Student Number</th>
                                    <th style="width:40%;">Name</th>
                                    <th style="width:25%;">Program</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if members %}
                                    {% for member in members %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>{{ member.student_no }}</td>
                                        <td>{{ member.name }}</td>
                                        <td>{{ member.program }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="4" class="text-center">No members found</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination controls removed -->
                </div>
            </div>

            <!-- Volunteers Tab -->
            <div class="tab-pane fade" id="volunteers" role="tabpanel" aria-labelledby="volunteers-tab">
                <div class="table-container">
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:10%;">No.</th>
                                    <th style="width:25%;">Student Number</th>
                                    <th style="width:40%;">Name</th>
                                    <th style="width:25%;">Program</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if volunteers %}
                                    {% for volunteer in volunteers %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>{{ volunteer.student_no }}</td>
                                        <td>{{ volunteer.name }}</td>
                                        <td>{{ volunteer.program }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="4" class="text-center">No volunteers found</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination controls removed -->
                </div>
            </div>

            <!-- Plans Tab -->
            <div class="tab-pane fade" id="plans" role="tabpanel" aria-labelledby="plans-tab">
                <div class="table-container">
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:4%;">No.</th>
                                    <th style="width:20%;">Programs/Projects/Activities</th>
                                    <th style="width:25%;">Objectives</th>
                                    <th style="width:12%;">Proposed Date</th>
                                    <th style="width:15%;">People Involved</th>
                                    <th style="width:12%;">Source of Funds</th>
                                    <th style="width:12%;">Venue</th>
                                    <th style="width:8%;">Outcome</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if plans %}
                                    {% for plan in plans %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>{{ plan.title }}</td>
                                        <td>{{ plan.objectives }}</td>
                                        <td>{{ plan.proposed_date }}</td>
                                        <td>{{ plan.people_involved }}</td>
                                        <td>{{ plan.funding_source }}</td>
                                        <td>{{ plan.venue|default('N/A') }}</td>
                                        <td class="{% if plan.is_accomplished %}outcome-successful{% else %}outcome-pending{% endif %}">
                                            {{ 'Successful' if plan.is_accomplished else 'Pending' }}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="8" class="text-center">No plans found</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}