{% extends 'user/userbase.html' %}

{% block title %}Organization Details{% endblock %}

{% block head_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/organizationdetails.css') }}?v={{ cache_version }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/organization.css') }}?v={{ cache_version }}">
<script src="{{ url_for('static', filename='js/manageorganization.js') }}?v={{ cache_version }}" defer></script>
<style>
  table th:nth-last-child(1),
  table td:nth-last-child(1) {
    text-align: center;
  }

  .organization-header {
    position: relative;
  }
  
  /* New Edit Organization Modal Styles */
  .container-short {
    margin: 0 auto;
  }
  
  .rounded-2xl {
    border-radius: 1rem;
  }
  
  .text-gray-500 {
    color: #6b7280;
  }
  
  .text-gray-900 {
    color: #111827;
  }
  
  .border-gray-100 {
    border-color: #f3f4f6;
  }
  
  /* Optimize textarea height handling with CSS */
  textarea.field-display {
    overflow: hidden;
    resize: none;
    min-height: 1.625rem;
    height: auto;
    box-sizing: border-box;
    width: 100%;
    transition: height 0.1s ease-in-out;
  }
  
  /* Ensure field containers have proper sizing */
  .field-container {
    width: 100%;
    position: relative;
  }
  
  .btn-upload {
    background-color: var(--button-color);
    color: white;
    border: none;
    border-radius: 0.375rem;
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
    cursor: pointer;
  }
  
  .btn-upload:hover {
    background-color: var(--button-hover);
  }
  
  .btn-edit {
    background-color: transparent;
    color: #6b7280;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    cursor: pointer;
  }
  
  .btn-edit:hover {
    background-color: #f3f4f6;
  }
</style>
{% endblock %}

{% block additional_content %}
    <section class="organization-header">
        <div class="d-flex justify-content-center align-items-center">
            <div class="d-flex flex-column flex-sm-row gap-5 align-items-center justify-content-center">
                {% if organization.logo_id %}
                <img src="{{ url_for('user_organization.get_logo', logo_id=organization.logo_id) }}" alt="{{ organization.organization_name }} logo" class="org-logo">
                {% else %}
                <img src="https://placehold.co/120x120/png/ffffff/000000?text=Logo" alt="Organization logo" class="org-logo">
                {% endif %}
                <div class="flex-grow-1 text-start">
                    <h2 class="org-title">{{ organization.organization_name }}</h2>
                    {% if organization.type %}
                    <p class="org-type"><strong>Type:</strong> {{ organization.type }}</p>
                    {% endif %}
                    {% if organization.tagline %}
                    <p class="org-quote">"{{ organization.tagline }}"</p>
                    {% endif %}
                    {% if organization.description %}
                    <p class="org-description">{{ organization.description }}</p>
                    {% endif %}
                    {% if adviser %}
                    <p class="org-adviser">Adviser: {{ adviser.full_name }}</p>
                    {% endif %}
                    {% if social_media %}
                    <p class="org-social">
                        <strong>Social Media:</strong><br>
                        {% for sm in social_media %}
                        {{ sm.platform }}: {{ sm.link }}<br>
                        {% endfor %}
                    </p>
                    {% endif %}
                    
                    <!-- Organization Management Buttons -->
                    <div class="mt-3 align-self-right">
                        <button type="button" class="btn btn-primary me-2 mb-2" style="font-size: 0.8rem;" onclick="showEditOrganizationModal()">
                            Edit Organization
                        </button>
                        <button type="button" class="btn btn-secondary me-2 mb-2" style="font-size: 0.8rem;" onclick="showAdviserInfoModal()">
                            Adviser Info
                        </button>
                        <i class="fas fa-link" style="font-size: 1.2rem; color: white; cursor: pointer;" onclick="showSocialMediaModal()" title="Social Media Links"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block content %}
<div class="container">
    <section class="stats-container">
        {% set stats = [
            {'class': 'stat-members', 'label': 'No. of Members', 'icon': 'fas fa-users', 'value': '35'},
            {'class': 'stat-volunteers', 'label': 'No. of Volunteers', 'icon': 'fas fa-hand-holding-heart', 'value': '13'},
            {'class': 'stat-activities', 'label': 'Accomplished Activities', 'icon': 'fas fa-tasks', 'value': '2'}
        ] %}
        
        {% for stat in stats %}
        <div class="stat-card {{ stat.class }}">
            <div>{{ stat.label }}</div>
            <div class="d-flex align-items-center fw-semibold fs-4">
                <i class="{{ stat.icon }} stat-icon"></i> {{ stat.value }}
            </div>
        </div>
        {% endfor %}
        
        <div class="stat-card stat-status">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                Organization Status
                <span class="status-active">Active</span>
            </div>
        </div>
    </section>

    <section class="table-container">
        <h3 class="table-title">Board of Officers</h3>
        <div class="table-scroll">
            <table>
                <thead>
                    <tr>
                        <th style="width:12%;">Position</th>
                        <th style="width:13%;">Student No.</th>
                        <th style="width:25%;">Name</th>
                        <th style="width:10%;">Program</th>
                        <th style="width:25%;">Address</th>
                        <th style="width:15%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% set officers = [
                    {'position': 'President', 'student_no': 'SUM2022-00001', 'name': 'Juan Miguel Dela Cruz', 'program': 'BSIT', 'address': 'Cabanatuan City, Nueva Ecija'},
                    {'position': 'Vice President', 'student_no': 'SUM2022-00002', 'name': 'Maria Elena Santos', 'program': 'BSIT', 'address': 'Gapan City, Nueva Ecija'},
                    {'position': 'Secretary', 'student_no': 'SUM2022-00003', 'name': 'Angelo Martin Reyes', 'program': 'BSIT', 'address': 'Cabanatuan City, Nueva Ecija'},
                    {'position': 'Treasurer', 'student_no': 'SUM2022-00004', 'name': 'Bianca Rose Mendoza', 'program': 'BSIT', 'address': 'Cabanatuan City, Nueva Ecija'},
                    {'position': 'Public Relations Officer', 'student_no': 'SUM2022-00005', 'name': 'Jasmine Mae Lim', 'program': 'BSIT', 'address': 'Palayan City, Nueva Ecija'},
                    {'position': 'Treasurer', 'student_no': 'SUM2022-00006', 'name': 'Miguel Antonio Tan', 'program': 'BSIT', 'address': 'Talavera, Nueva Ecija'},
                    {'position': 'Events Coordinator', 'student_no': 'SUM2022-00007', 'name': 'Sofia Marie Garcia', 'program': 'BSIT', 'address': 'Cabanatuan City, Nueva Ecija'},
                    {'position': 'Technical Lead', 'student_no': 'SUM2022-00008', 'name': 'Diego Rafael Bautista', 'program': 'BSIT', 'address': 'Gapan City, Nueva Ecija'},
                    {'position': 'Membership Coordinator', 'student_no': 'SUM2022-00009', 'name': 'Isabella Marie Lopez', 'program': 'BSIT', 'address': 'Cabanatuan City, Nueva Ecija'}
                    ] %}
                    
                    {% for officer in officers %}
                    <tr>
                        <td>{{ officer.position }}</td>
                        <td>{{ officer.student_no }}</td>
                        <td>{{ officer.name }}</td>
                        <td>{{ officer.program }}</td>
                        <td>{{ officer.address }}</td>
                        <td>
                            <button type="button" class="btn btn-primary btn-sm" onclick="showEditOfficerModal('{{ officer.position }}', '{{ officer.student_no }}', '{{ officer.name }}', '{{ officer.program }}', '{{ officer.address }}')">
                                <i class="fas fa-edit"></i> Update
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end mb-2 mt-3">
            <button type="button" class="btn btn-primary" style="background-color: #0D3B44;" onclick="showOfficerModal()">
                <i class="fas fa-plus"></i> Add Officer
            </button>
        </div>
    </section>

    <section class="row g-4 mb-1">
        {% set people_tables = [
            {'title': 'Members', 'id': 'members'},
            {'title': 'Volunteer', 'id': 'volunteers'}
        ] %}
        
        {% for table in people_tables %}
        <div class="col-12 col-md-6">
            <section class="table-container">
                <h3 class="table-title">{{ table.title }}</h3>
                <div class="table-scroll">
                    <table>
                        <thead>
                            <tr>
                                <th style="width:8%;">No.</th>
                                <th style="width:20%;">Student No.</th>
                                <th style="width:27%;">Name</th>
                                <th style="width:20%;">Program</th>
                                <th style="width:25%;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% set members = [
                            {'no': '1', 'student_no': 'SUM2022-00001', 'name': 'Miguel Santos Sanchez', 'program': 'BSIT'},
                            {'no': '2', 'student_no': 'SUM2022-00002', 'name': 'Sophia Marie Chen', 'program': 'BSIT'},
                            {'no': '3', 'student_no': 'SUM2022-00003', 'name': 'Amir Hassan Khan', 'program': 'BSIT'},
                            {'no': '4', 'student_no': 'SUM2022-00004', 'name': 'Isabella Maria Rodríguez', 'program': 'BSIT'},
                            {'no': '5', 'student_no': 'SUM2022-00005', 'name': 'Liam Patrick O\'Connor', 'program': 'BSIT'},
                            {'no': '6', 'student_no': 'SUM2022-00006', 'name': 'Priya Raj Patel', 'program': 'BSIT'},
                            {'no': '7', 'student_no': 'SUM2022-00007', 'name': 'Mateo Luis Fernandez', 'program': 'BSIT'},
                            {'no': '8', 'student_no': 'SUM2022-00008', 'name': 'Zoe Elizabeth Williams', 'program': 'BSIT'},
                            {'no': '9', 'student_no': 'SUM2022-00009', 'name': 'Jamal Andre Washington', 'program': 'BSIT'},
                            {'no': '10', 'student_no': 'SUM2022-00010', 'name': 'Mei Ling Zhang', 'program': 'BSIT'}
                            ] %}

                            {% for member in members %}
                            <tr>
                                <td>{{ member.no }}</td>
                                <td>{{ member.student_no }}</td>
                                <td>{{ member.name }}</td>
                                <td>{{ member.program }}</td>
                                <td>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="showEditMemberModal('{{ member.student_no }}', '{{ member.name }}', '{{ member.program }}')">
                                        <i class="fas fa-edit"></i> Update
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls">
                    <button type="button"><i class="fas fa-chevron-left"></i> Previous</button>
                    <button type="button">Next <i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="d-flex justify-content-end mb-2 mt-3">
                    <button type="button" class="btn btn-primary" style="background-color: #0D3B44;" onclick="show{{ table.title }}Modal()">
                        <i class="fas fa-plus"></i> Add {{ table.title }}
                    </button>
                </div>
            </section>
        </div>
        {% endfor %}
    </section>

    <section class="table-container">
    <h3 class="table-title">Plans</h3>
    <div class="table-scroll">
        <table>
        <thead>
            <tr>
            <th style="width:4%;">No.</th>
            <th style="width:18%;">Programs/Projects/Activities</th>
            <th style="width:23%;">Objectives</th>
            <th style="width:10%;">Proposed Date</th>
            <th style="width:13%;">People Involved</th>
            <th style="width:10%;">Source of Funds</th>
            <th style="width:10%;">Venue</th>
            <th style="width:7%;">Outcome</th>
            <th style="width:5%;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% set plans = [
            {
                'no': '1',
                'title': 'Alay sa First Year',
                'objectives': 'Support the competitors in different contests in the event. To disseminate SSITE objectives through booth pitching',
                'date': 'August 05, 2023',
                'people': 'SSITE Officers and Members',
                'funds': 'SSITE Funds<br><small>(if necessary)</small>',
                'venue': 'NEUST Close Gym',
                'outcome': 'Successful'
            },
            {
                'no': '2',
                'title': 'Midterm Exam 2023 motivational support to CICT Students',
                'objectives': 'Provide members support for their review and preparation for the term examinations.',
                'date': 'October 13, 2023',
                'people': 'SSITE Officers',
                'funds': 'SSITE Funds<br><small>(if necessary)</small>',
                'venue': 'CICT Department',
                'outcome': 'Successful'
            }
            ] %}
            
            {% for plan in plans %}
            <tr>
            <td>{{ plan.no }}</td>
            <td>{{ plan.title }}</td>
            <td>{{ plan.objectives }}</td>
            <td>{{ plan.date }}</td>
            <td>{{ plan.people }}</td>
            <td>{{ plan.funds|safe }}</td>
            <td>{{ plan.venue }}</td>
            <td class="outcome-successful">{{ plan.outcome }}</td>
            <td>
                <button type="button" class="btn btn-primary btn-sm" onclick="showEditPlanModal('{{ plan.no }}', '{{ plan.title }}', '{{ plan.objectives }}', '{{ plan.date }}', '{{ plan.people }}', '{{ plan.funds }}', '{{ plan.venue }}', '{{ plan.outcome }}')">
                    <i class="fas fa-edit"></i> Update
                </button>
            </td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
    </div>
    <div class="d-flex justify-content-end mb-2 mt-3">
        <button type="button" class="btn btn-primary" style="background-color: #0D3B44;" onclick="showAddPlanModal()">
            <i class="fas fa-plus"></i> Add Plan
        </button>
    </div>
    </section>
</div>


<!-- New Edit Organization Modal -->
<div id="editOrganizationModal" class="global-modal">
    <div class="modal-container">
        <button class="btn-back" onclick="hideEditOrganizationModal()" style="font-size: 0.75rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; padding: 0;">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="container-short"> 
            <main> 
                <!-- Logo Upload Section --> 
                <section class="bg-light rounded-2xl p-3 d-flex flex-column flex-sm-row align-items-center gap-3"> 
                    {% if organization.logo_id %}
                    <img id="previewLogo" src="{{ url_for('user_organization.get_logo', logo_id=organization.logo_id) }}" alt="{{ organization.organization_name }} logo" class="rounded-circle" style="width:96px; height:96px; object-fit: cover;" />
                    {% else %}
                    <img id="previewLogo" src="https://placehold.co/120x120/png/ffffff/000000?text=Logo" alt="Organization logo" class="rounded-circle" style="width:96px; height:96px; object-fit: cover;" />
                    {% endif %} 
                    <div class="d-flex flex-column gap-1"> 
                        <input type="file" id="logoFileInput" style="display: none;" accept="image/*" onchange="handleLogoFileSelect(event)">
                        <div id="logoUploadButtons">
                            <button type="button" class="btn btn-primary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="uploadNewLogo()">Upload New Logo</button>
                        </div>
                        <div id="logoSaveButtons" style="display: none;">
                            <button type="button" class="btn btn-success" style="font-size: 0.75rem; padding: 0.25rem 0.5rem; margin-right: 0.5rem;" onclick="saveLogo()">Save</button>
                            <button type="button" class="btn btn-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="cancelLogoUpload()">Cancel</button>
                        </div>
                        <p class="text-gray-500 mb-0" style="max-width: 260px; font-size: 0.75rem;"> 
                            At least <strong>800×800 px</strong> recommended.<br />JPG or PNG is allowed 
                        </p> 
                    </div> 
                </section> 
         
                <!-- Organization Info Section --> 
                <section class="bg-white rounded-2xl border border-gray-100 mt-4 p-3 section-organization"> 
                    <div class="d-flex justify-content-between align-items-center mb-3"> 
                        <label for="org-name-field" class="fw-semibold text-gray-900 mb-0" style="font-size: 0.75rem;">Organization</label> 
                        {% if organization.organization_name %}
                        <button type="button" class="btn btn-outline-secondary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditOrganizationNameForm()"> 
                            <i class="fas fa-pen" style="font-size: 0.75rem;"></i> 
                            Edit
                        </button>
                        {% else %}
                        <button type="button" class="btn btn-primary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditOrganizationNameForm()"> 
                            <i class="fas fa-plus" style="font-size: 0.75rem;"></i> 
                            Add
                        </button>
                        {% endif %} 
                    </div> 
                    <div class="field-container" style="line-height: 1.625; font-size: 0.75rem;"> 
                        <textarea id="org-name-field" class="field-display" readonly>{% if organization.organization_name %}{{ organization.organization_name }}{% endif %}</textarea> 
                    </div> 
                </section> 
         
                <!-- Type Section --> 
                <section class="bg-white rounded-2xl border border-gray-100 mt-4 p-3 section-type"> 
                    <div class="d-flex justify-content-between align-items-center mb-3"> 
                        <label for="org-type-field" class="fw-semibold text-gray-900 mb-0" style="font-size: 0.75rem;">Type</label> 
                        {% if organization.type %}
                        <button type="button" class="btn btn-outline-secondary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditOrganizationTypeForm()"> 
                            <i class="fas fa-pen" style="font-size: 0.75rem;"></i> 
                            Edit
                        </button>
                        {% else %}
                        <button type="button" class="btn btn-primary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditOrganizationTypeForm()"> 
                            <i class="fas fa-plus" style="font-size: 0.75rem;"></i> 
                            Add
                        </button>
                        {% endif %} 
                    </div> 
                    <div class="field-container" style="line-height: 1.625; font-size: 0.75rem;"> 
                        <textarea id="org-type-field" class="field-display" readonly>{% if organization.type %}{{ organization.type }}{% endif %}</textarea> 
                    </div> 
                </section> 
         
                <!-- Tagline Section --> 
                <section class="bg-white rounded-2xl border border-gray-100 mt-4 p-3 section-tagline"> 
                    <div class="d-flex justify-content-between align-items-center mb-3"> 
                        <label for="org-tagline-field" class="fw-semibold text-gray-900 mb-0" style="font-size: 0.75rem;">Tagline</label> 
                        {% if organization.tagline %}
                        <button type="button" class="btn btn-outline-secondary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditTaglineForm()"> 
                            <i class="fas fa-pen" style="font-size: 0.75rem;"></i> 
                            Edit
                        </button>
                        {% else %}
                        <button type="button" class="btn btn-primary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditTaglineForm()"> 
                            <i class="fas fa-plus" style="font-size: 0.75rem;"></i> 
                            Add
                        </button>
                        {% endif %} 
                    </div> 
                    <div class="field-container" style="line-height: 1.625; font-size: 0.75rem;"> 
                        <textarea id="org-tagline-field" class="field-display" readonly>{% if organization.tagline %}{{ organization.tagline }}{% endif %}</textarea> 
                    </div> 
                </section> 
         
                <!-- Description Section --> 
                <section class="bg-white rounded-2xl border border-gray-100 mt-4 p-3 section-description"> 
                    <div class="d-flex justify-content-between align-items-center mb-3"> 
                        <label for="org-description-field" class="fw-semibold text-gray-900 mb-0" style="font-size: 0.75rem;">Description</label> 
                        {% if organization.description %}
                        <button type="button" class="btn btn-outline-secondary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditDescriptionForm()"> 
                            <i class="fas fa-pen" style="font-size: 0.75rem;"></i> 
                            Edit
                        </button>
                        {% else %}
                        <button type="button" class="btn btn-primary d-flex align-items-center gap-1" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="showEditDescriptionForm()"> 
                            <i class="fas fa-plus" style="font-size: 0.75rem;"></i> 
                            Add
                        </button>
                        {% endif %} 
                    </div> 
                    <div class="field-container" style="line-height: 1.625; font-size: 0.75rem;"> 
                        <textarea id="org-description-field" class="field-display" readonly>{% if organization.description %}{{ organization.description }}{% endif %}</textarea> 
                    </div> 
                </section>
                
                <!-- No global save button as each section has its own save functionality -->
            </main> 
        </div>
    </div>
</div>
{% endblock %}